angular.module("App",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","angular-growl","App.authServices","App.base64Services","App.apiServices","App.landingServices","App.userServices","App.moduleServices","App.contentServices","App.modalServices"]).config(["growlProvider","$httpProvider","$locationProvider","$routeProvider",function(a,b,c,d){"use strict";a.globalTimeToLive({success:2e3,error:2e3,warning:3e3,info:5e3}).globalInlineMessages(!1).globalPosition("top-right").globalDisableIcons(!1),b.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",b.defaults.useXDomain=!0,b.defaults.withCredentials=!0,b.interceptors.push("authInterceptor"),c.html5Mode(!0).hashPrefix("!"),window.history&&window.history.pushState&&c.html5Mode({enabled:!0,requireBase:!1}).hashPrefix("!"),d.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main",resolve:{app:["$q","$timeout",function(a,b){var c=a.defer();return b(function(){c.resolve()}),c.promise}]},access:{requireLogin:!1}}).when("/:module",{templateUrl:"views/modules/index.html",controller:"ModulesCtrl",controllerAs:"app",resolve:{app:["$q","$timeout",function(a,b){var c=a.defer();return b(function(){c.resolve()}),c.promise}]},access:{requireLogin:!0}}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$route","$http","$location","$window","AuthenticationService",function(a,b,c,d,e,f){c.defaults.transformRequest.push(function(b){return a.disableButton=!0,angular.element(".loading-spinner-holder").show(),b}),c.defaults.transformResponse.push(function(b){return a.disableButton=!1,angular.element(".loading-spinner-holder").hide(),b}),a.$on("$routeChangeStart",function(a,b){null===b||null===b.access||f.isLogged||e.sessionStorage.token||d.path("/")})}]),angular.module("App").controller("MainCtrl",["$log","$rootScope","$scope","$location","$window","utils","AuthenticationService","userService","landingService","growl",function(a,b,c,d,e,f,g,h,i,j){"use strict";this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],e.sessionStorage.token?d.url("/dashboard"):(a.info("SCOPE > ",c),c.currentModule={name:null,modal:{method:"get"},type:0},c.modalWindow=function(a){return i[a](a,c)},c.login=function(){var d=c.user;a.info("|--------------------------------------|"),a.info("USER >> ",d),j.warning("Checking Your Credentials",{referenceId:1,ttl:3e3}),h.loginUser(d).then(function(){b.assets||(b.assets=[]),g.isLogged=!0,a.info("load environment..."),j.info("Loading Your Environment",{referenceId:1,onopen:function(){angular.element("#fmLogin").css("display","none")}}),j.success("Logged In Successfully!",{referenceId:1,onclose:function(){e.location.href="/dashboard"}})},function(a){g.isLogged=!1;var b="Error: "+a;f.growlMessage("error",b,1)})})}]),angular.module("App").controller("ModulesCtrl",["$log","$rootScope","$scope","$window","$location","$route","base64","moduleService","contentService",function(a,b,c,d,e,f,g,h,i){"use strict";this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.info("$rootScope: ",b),a.info("$scope: ",c),c.logout=function(){g.deleteJwtFromSessionStorage()},d.sessionStorage.token?(c.isActive=function(a){return e.path().indexOf(a)>-1},b.profile=JSON.parse(d.sessionStorage.profile),b.credentials=JSON.parse(d.sessionStorage.credentials),b.modules=JSON.parse(d.sessionStorage.modules),b.system=JSON.parse(d.sessionStorage.system),h.loadModule(f,c).then(function(){a.info("currentModule: ",c.currentModule),h.activeModule(f,c)})):g.deleteJwtFromSessionStorage()}]),angular.module("App.authServices",[]).factory("AuthenticationService",["$rootScope","$window",function(a,b){"use strict";var c;return b.sessionStorage.token||(c={isLogged:!1}),b.sessionStorage.token&&(c={isLogged:!0}),a.auth=c,console.log("isLogged",c),c}]).factory("authInterceptor",["$rootScope","$q","$window",function(a,b,c){return{request:function(a){return a.headers=a.headers||{},c.sessionStorage.token&&(a.headers.Authorization="Bearer "+c.sessionStorage.token,a.headers.useXDomain=!0,a.headers.withCredentials=!0),a},response:function(a){return 401===a.status&&console.log("Not Logged On"),a||b.when(a)}}}]).config(["$httpProvider",function(a){a.interceptors.push("authInterceptor")}]),angular.module("App.base64Services",[]).factory("base64",["$window","$location","$q","utils",function(a,b,c,d){"use strict";return{encode:function(a){return d.stringEncode(a)},decode:function(a){var b=a.replace("-","+").replace("_","/");switch(console.log("output",b),b.length%4){case 0:break;case 2:b+="==";break;case 3:b+="=";break;default:throw"Illegal base64url string!"}return window.atob(b)},getJwtProfile:function(){var b,d,e=c.defer();return a.sessionStorage.token?(b=a.sessionStorage.token.split(".")[1],d=JSON.parse(this.decode(b)),e.resolve(d)):e.reject("OOPS No JWT Token exists in sessionStorage!!! "),e.promise},deleteJwtFromSessionStorage:function(){for(var b=sessionStorage.length;b--;){var c=sessionStorage.key(b);sessionStorage.removeItem(c)}a.location.href=a.location.origin},saveJwtToSessionStorage:function(b){console.log("jwtService.saveJwtToSessionStorage.token: ",b),a.sessionStorage.token=b,a.sessionStorage.idx=0}}}]),angular.module("App.apiServices",[]).service("restAPI",["$rootScope","$http","$window","$location","$resource",function(a,b,c,d,e){"use strict";var f="https://localhost:5001/",g=c.sessionStorage.token;return b.defaults.headers.common["X-Auth-Token"]=g,{userLogin:e(f+"auth/login",{email:"@email",passwd:"@passwd"},{method:"POST",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PATCH, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Origin, Content-Type, X-Auth-Token"},contentType:"application/json",isArray:!0}),getModules:e(f+"api/:module/:table",{module:"@module",table:"@table",params:"@params"},{method:"GET",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"GET, POST, PATCH, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Origin, Content-Type, X-Auth-Token"},withCredentials:!0,isArray:!0}),getSchema:e(f+"api/schema",{module:"@module",table:"@table",params:"@params"},{method:"GET",withCredentials:!0,isArray:!0}),postTransaction:e(f+"/api/:module/:method",{module:"@module",method:"@method",params:"@params"},{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},contentType:"application/json",withCredentials:!0,isArray:!1})}}]),angular.module("App.userServices",[]).service("userService",["$log","$http","$q","$window","$location","$cookies","restAPI","base64","$rootScope","AuthenticationService","utils",function(a,b,c,d,e,f,g,h,i,j,k){"use strict";return{loggedOnAlreadyMsg:function(){h.getJwtProfile().then(function(){return e.url("/#!/dashboard"),this})},loginUser:function(b){var e=c.defer();return g.userLogin.save(b,function(c){a.info("login form",b),a.info("login response",c);var f=c;if(a.info("|----------------------------------------|"),a.info("USER-SERVICE.RESTAPI-USER-LOGIN.RESPONSE >> ",JSON.stringify(c)),a.info("|----------------------------------------|"),a.info("RESULTS >> ",f),401===f.status&&k.growlMessage("warning",f.msg,1),500===f.status&&k.growlMessage("error",f.msg,1),200===f.status){h.saveJwtToSessionStorage(f.token);var g=f.payload;i.credentials=g.permissions,i.system=g.system,i.assets=[],i.organization=g.organization,i.profile=g.profile,i.modules=g.modules,i.system=g.type,d.sessionStorage.profile=JSON.stringify(i.profile),d.sessionStorage.credentials=JSON.stringify(i.credentials),d.sessionStorage.organization=JSON.stringify(i.organization),d.sessionStorage.modules=JSON.stringify(i.modules),d.sessionStorage.system=JSON.stringify(i.system),e.resolve(c)}}),e.promise},logoutUser:function(){var a=c.defer();return a.resolve("Successfully logged out!"),j.isLogged=!1,i.permissions.destroy(),i.credentials.destroy(),i.profile.destroy(),i.locations.destroy(),i.modules.destroy(),i.env.destroy(),d.sessionStorage.destroy(),f.remove("x-token"),delete f["x-token"],d.location.href=d.location.origin,a.promise}}}]),angular.module("App.landingServices",[]).service("landingService",["$rootScope","$compile","$q","utils","elements","modalService",function(a,b,c,d,e,f){"use strict";return{form:function(a,b){var c="";return c+='<div class="row"><form class="form-horizontal" name="frm',c+=d.stringCapitalise(a)+'" id = "frm'+d.stringCapitalise(a),c+='" novalidate data-ng-show="!AuthenticationService.isLogged"',c+='ng-submit="login()" autocomplete="false">',c+=b,c+="</form></div>"},login:function(a,c){c.user={email:null,passwd:null},console.log("landingService."+a),c.currentModule.name=a,f.launchModal(c);var d=this,e="";e+='<input type="email" style="display:none;"/>',e+='<input type="password" style="display:none;"/>',e+='<div growl inline="false" reference="1"></div>',e+='<div id="fmLogin" class="col-sm-12"><div class="form-group"><div class="col-sm-2">',e+='<label for="email">Email</label></div><div class="col-sm-6">',e+='<input type="email" name="email" class="form-control" data-ng-model="user.email"',e+=' data-ng-required="true" autocomplete="false" placeholder="Email Address"/>',e+='</div></div><div class="form-group"><div class="col-sm-2">',e+='<label for="password">Password</label></div><div class="col-sm-6">',e+='<input type="password" name="passwd" class="form-control" data-ng-model="user.passwd"',e+=' data-ng-required="true" autocomplete="false" placeholder="Password"/></div></div>',angular.element("#modalContainer").html(b(d.form(a,e))(c))},register:function(a,b){console.log("landingService."+a),b.currentModule.name=a,f.launchModal(b),angular.element("#modalContainer").html("Load the "+a)},contact:function(a,b){console.log("landingService."+a),b.currentModule.name=a,f.launchModal(b),angular.element("#modalContainer").html("Load the "+a)}}}]),angular.module("App.moduleServices",[]).service("moduleService",["$log","$q","$rootScope","$compile","$window","$location","$route","AuthenticationService","base64","utils","restAPI",function(a,b,c,d,e,f,g,h,i,j,k){"use strict";return{modulePagingOptions:function(a){return{limit:25,offset:0,totalRecords:0,page:1,options:[10,25,50,100,150,200],range:{lower:0,upper:25,total:0}}},newPagingOptions:function(a,b,c,d,f,g){var h=parseInt(a*c)||1,i=parseInt(h-a+1)||1,j={limit:a||25,offset:i||0,page:c||1,options:g.currentModule.paging.options,totalRecords:g.currentModule.paging.totalRcords,range:{lower:i||1,upper:h||1,total:g.currentModule.paging.totalRecords}};g.currentModule.paging=j,e.sessionStorage.paging=JSON.stringify(g.currentModule.paging)},loadModule:function(d,g){if(e.sessionStorage.token){var h=f.path().split("/"),j=(e.sessionStorage.idx,JSON.parse(e.sessionStorage.modules)),k=(JSON.parse(e.sessionStorage.profile),JSON.parse(e.sessionStorage.credentials),{}),l=b.defer(),m=0;for(h.shift(),c.assets||(c.assets=[]),a.info("Modules : ",j),m=0;m<j.length;m++)j[m].name.toLowerCase()===h[0]&&(k={id:j[m].id,name:j[m].name,paging:{}},k.permissions=c.credentials,g.currentModule=k);return l.resolve(k),l.promise}i.deleteJwtFromSessionStorage()},activeModule:function(c,d){var f=b.defer(),g=d.currentModule,h=g.name.toLowerCase(),i=1,j=(parseInt(e.sessionStorage.idx),{}),l={};j=e.sessionStorage.paging?JSON.parse(e.sessionStorage.paging):this.modulePagingOptions(g),g.paging=j;var m={module:h,type:i,paging:j,filters:l,organization:JSON.parse(e.sessionStorage.organization).id,token:e.sessionStorage.token.toString()};return 1===angular.element("div.modal").length?angular.element("div.modal-dialog").show():"dashboard"===h?a.info("LOAD DASHBOARD"):(a.info("moduleData : ",m),k.getModules.query(m,function(b){a.info("|--------------------------------------|"),a.info(h+" RESULTS >> ",b)})),f.promise}}}]),angular.module("App.contentServices",[]).service("contentService",["$log","$rootScope","$q","$timeout","$window","$location","$route","$compile","utils","elements","moduleService",function(a,b,c,d,e,f,g,h,i,j,k){"use strict";return{newPagingOptions:function(a){console.log("|-------------------------------------|"),console.log("SCOPE >> ",a);var b=this,c=a.$parent.currentModule.paging,d=c.limit*c.page,f=parseInt(d-c.limit);c.range.lower=f,c.range.upper=d,c.range.total=c.totalRecords,c.offset=f,a.$parent.currentModule.paging=c,e.sessionStorage.paging=JSON.stringify(a.currentModule.paging),b.loadModule(g,a)},loadContent:function(a,c){var d="",f=(c.currentModule,JSON.parse(e.sessionStorage.credentials));parseInt(f.group_id),angular.lowercase(c.currentModule.name),parseInt(c.currentModule.type),parseInt(e.sessionStorage.establishment),b.profile.manufacturers;viewService.viewBuild(a,c).then(function(a){d+="<div data-ng-include=\"'views/modules/_partials/_buttons/_viewbuttons.html'\"/>"+a.content,j.insertHTML(d,c)},function(a){console.log("viewServices.viewBuild Error",a)})},loadError:function(b,c,d){errorService.contentError(b,c,d).then(function(a){c.currentModule.paging.totalRecords=0;var b=a.content;j.insertHTML(b.replace("NaN",""),c)},function(b){a.info("viewServices.viewBuild Error",b)})}}}]),angular.module("App.modalServices",[]).service("modalService",["$q","$compile","utils","buttons",function(a,b,c,d){"use strict";return{closeModal:function(){angular.element(".modal").remove()},launchModal:function(a){console.log("|----------------------------------------|"),console.log("launchModal.$scope",a);var e=this,f="",g="",h="",i=a.currentModule,j=i.name,k=i.modal.method;i.type;Element.prototype.setAttributes=function(a){for(var b in a)if("styles"!==b&&"style"!==b||"object"!=typeof a[b])"html"===b?this.innerHTML=a[b]:this.setAttribute(b,a[b]);else for(var c in a[b])this.style[c]=a[b][c]},f+='<div class="modal-dialog modal-lg" data-backdrop="static" data-keyboard="false">',f+='<div class="modal-content">',f+='<div class="modal-header">',f+='<span class="pull-right">'+d.modalTimesClose(),f+='<div growl inline="false" reference="3"/>',f+='</span><h4 class="modal-title">',f+='</span><h4 class="modal-title clearfix">',f+='<div class="modal-spinner-holder pull-left" style="display:none" data-loading>',f+='<div class="modal-spinner">',f+='<i class="fa fa-spinner fa-pulse fa-1x fa-fw margin-bottom"></i>',f+="</div></div>",f+=c.stringCapitalise(k+" "+j),f+="</h4></div>",g+='<div class="modal-body container-fluid" id="modalContainer" bs-affix-target>',g+="</div>",h+='<div class="modal-footer">',h+=d.modalClose(),h+=d.modalSubmit(j,k),h+="</div></div></div>";var l=f+g+h,m=(c.camelCase(j+"-"+k),document.createElement("div"));m.setAttributes({class:"modal fade",role:"document",style:{display:"none"}}),m.appendChild(document.createDocumentFragment(l)),angular.element("div#wrap").append(b(m)(a)),angular.element("div.modal").html(b(l)(a)),angular.element("div.modal").modal().on("hidden.bs.modal",function(a){e.closeModal()})}}}]),angular.module("App").factory("utils",["$q","$window",function(a,b){"use strict";return{validateEmail:function(a){return/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/.test(a)},validateNAPhone:function(a){return/^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/.test(a)},validateUKPhone:function(a){return/^\s*\(?(020[7,8]{1}\)?[ ]?[1-9]{1}[0-9{2}[ ]?[0-9]{4})|(0[1-8]{1}[0-9]{3}\)?[ ]?[1-9]{1}[0-9]{2}[ ]?[0-9]{3})\s*$/.test(a)},validateEUPhone:function(a){return/^(?:0|\(?\+33\)?\s?|0033\s?)[1-79](?:[\.\-\s]?\d\d){4}$/.test(a)},validateZipCode:function(a){return/(\d{5}([\-]\d{4})?)/.test(a)},validateCDNPostalCode:function(a){return/[A-Za-z][0-9][A-Za-z] [0-9][A-Za-z][0-9]/.test(a)},validateUKPostalCode:function(a){return/[A-Za-z]{1,2}[0-9Rr][0-9A-Za-z]? [0-9][ABD-HJLNP-UW-Zabd-hjlnp-uw-z]{2}/.test(a)},validatePassword:function(a){return/(?=^.{8,}$)((?=.*\d)|(?=.*\W+))(?![.\n])(?=.*[A-Z])(?=.*[a-z]).*$/.test(a)},isNumber:function(a){return/^-?[\d.]+(?:e-?\d+)?$/.test(a)},isNull:function(a){return!a},padZerosToLength:function(a,b,c){var d=a.toString().length;return new Array(b+1-d).join(c)+a},stringCapitalise:function(a){if("undefined"!==this.toType(a)){for(var b=a.toLowerCase(),c=0,d=0;d<b.length;d++)0===d&&/[a-zA-Z]/.test(b.charAt(d))&&(c=2),0===c&&/[a-zA-Z]/.test(b.charAt(d))&&(c=2),1===c&&/[^a-zA-Z]/.test(b.charAt(d))&&"'"===b.charAt(d)&&(d+2===b.length&&/[a-zA-Z]/.test(b.charAt(d+1))?c=3:d+2<b.length&&/[^a-zA-Z]/.test(b.charAt(d+2))&&(c=3)),c=3===c?1:0,2===c?(c=1,b=b.substr(0,d)+b.charAt(d).toUpperCase()+b.substr(d+1)):b=b.substr(0,d)+b.charAt(d).toLowerCase()+b.substr(d+1);return b}},camelCase:function(a){return a.toLowerCase().replace(/-(.)/g,function(a,b){return b.toUpperCase()})},stringEncode:function(a){return window.btoa(encodeURI(a))},stringDecode:function(a){return decodeURI(window.atob(a))},toType:function(a){return{}.toString.call(a).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},hayStack:function(a){var b,c=a!==a;return b=c||"function"!=typeof Array.prototype.indexOf?function(a){var b=-1,d=-1;for(b=0;b<this.length;b++){var e=this[b];if(c&&e!==e||e===a){d=b;break}}return d}:Array.prototype.indexOf,b.call(this,a)>-1},countJSON:function(a){return Object.keys(a).length},roundUp:function(a,b){b=b||0,a=a||0;var c=Math.round(100*String(a))/100;return Number(c.toFixed(b))}}}]),angular.module("App").factory("elements",["$compile","utils",function(a,b){"use strict";return{insertHTML:function(b,c){angular.element("#insertModule").html(a(b)(c))}}}]),angular.module("App").factory("buttons",["$rootScope","utils",function(a,b){"use strict";return{viewButton:function(){var a='<button type="button" class="btn btn-xs"';return a+=' data-id="view"',a+=' data-ng-click="button($index, $event)"',a+=' data-ng-disabled="disableButton">',a+='<i class="fa fa-eye"></i></button>'},editButton:function(){var a='<button type="button" class="btn btn-xs"';return a+=' data-id="edit"',a+=' data-ng-click="button($index, $event)"',a+=' data-ng-disabled="disableButton"',a+=' style="margin-top: 5px;">',a+='<i class="fa fa-pencil"></i></button>'},deleteButton:function(){var a='<button type="button" class="btn btn-sm"';return a+=' data-id="delete"',a+=' data-ng-click="button($index, $event)"',a+=' data-ng-disabled="disableButton">',a+='<i class="fa fa-trash-o"></i></button>'},modalClose:function(){var a='<button class="btn btn-sm btn-default" data-dismiss="modal" data-ng-click="resetModal();">';return a+='<i class="fa fa-times"></i> cancel</button>'},modalTimesClose:function(){var a='<button type="button" class="close" data-dismiss="modal" aria-label="Close"';return a+=' data-ng-click="closeModal();">',a+='<span aria-hidden="true"><i class="fa fa-times"></i></span></button>'},modalSubmit:function(a,c){var d='<button class="btn btn-sm btn-primary"';return d+="login"===a?' data-ng-click="login()">':" data-ng-click=\"modalSubmit('"+c+"');\">",d+='<i class="fa fa-save"></i>',d+=" <small>"+b.stringCapitalise(c.replace(/_/g," ")),d+=" "+b.stringCapitalise(a.replace(/_/g," ")),d+="</small></button>"},modalExit:function(){var a='<button type="button" class="btn btn-sm btn-default"';return a+=' data-dismiss="modal" aria-label="Close" data-ng-click="closeModal();">',a+='<span aria-hidden="true"><i class="fa fa-times"></i> Close</span></button>'}}}]),angular.module("wwwApp").run(["$templateCache",function(a){"use strict";a.put("views/main.html",'<div class="header"> <ul class="nav nav-pills pull-right"> <li><a href="javascript:void(0);" data-ng-click="modalWindow(\'register\')">Request Info</a></li> <li><a href="javascript:void(0);" data-ng-click="modalWindow(\'login\')">Login</a></li> <li><a href="javascript:void(0);" data-ng-click="modalWindow(\'contact\')">Contact</a></li> </ul> <a data-ng-href=""><img class="brand" src="images/small-logo.787da320.png"></a> </div> <div class="container"> <div class="row"> <h4>Landing Page</h4> </div> </div>'),a.put("views/modules/index.html",'<div id="modules"> <div data-ng-include="\'views/modules/_partials/_layout/_header.html\'"></div> <div id="sections" class="container-fluid"> \x3c!-- module header section --\x3e <div class="row clearfix"> <div class="col-md-9"> <h2 class="clearfix"> <div class="loading pull-left" style="display:none" data-loading> <div class="loading-spinner"> <i class="fa fa-spinner fa-pulse fa-1x fa-fw margin-bottom"></i> </div> </div> <i class="{{currentModule.ico}}"></i> <span data-ng-bind="currentModule.name"></span> <span data-ng-hide="currentLocation === \'/settings\' || currentLocation === \'/profile\' || currentLocation === \'/system\' || currentLocation === \'/support\'"> <small> - <span data-ng-bind="currentModule.location.value"></span></small> </span> <span data-ng-show="currentLocation === \'/settings\' || currentLocation === \'/profile\'"> <small> - <span data-ng-bind="profile.Name.FullName"></span></small> </span> <span data-ng-show="currentLocation === \'/system\'"> <small> - <span data-ng-bind="credentials.group"></span></small> </span> </h2> </div> </div> \x3c!-- // --\x3e <div growl inline="false" reference="2"></div> \x3c!-- load sections via angular-templates --\x3e <div class="row clearfix"> <hr class="hidden-xs"> <div id="insertModule" class="container-fluid"></div> </div> </div> </div>')}]);